{"componentChunkName":"component---src-templates-blog-post-js","path":"/lazy-loading-images/","result":{"data":{"site":{"siteMetadata":{"title":"tech crafts"}},"markdownRemark":{"id":"cc85ac43-7658-5d0c-bed3-94287bf1e1b7","excerpt":"Todos n√≥s adoramos ver imagens e gifs na internet, certo? E estamos usando a internet cada vez mais para nos conectarmos com pessoas e conhecimentos. Pra‚Ä¶","html":"<p>Todos n√≥s adoramos ver imagens e gifs na internet, certo? E estamos usando a internet cada vez mais para nos conectarmos com pessoas e conhecimentos. Pra garantir que a experi√™ncia de seu/sua cliente seja boa, uma √≥tima coisa √© usar estrat√©gia de Lazy Loading nas suas imagens.</p>\n<p>Basicamente, √© voc√™ dizer ao navegador para baixar a imagem somente quando ela estiver <b>vis√≠vel</b>, e isso pode otimizar MUITO o carregamento da sua p√°gina.</p>\n<p>Observe o que acontece ao acessar o Pinterest monitorando o tr√°fego de rede:</p>\n<video autoplay loop style=\"width:100%\">\n  <source src=\"/4b92b10a19504bbbc387f0ff66699186/pinterest-image-lazy-loading.mov\" type=\"video/mp4\">\n</video>\n<br>\n<br>\nConforme navegamos na p√°gina e passamos a ver mais imagens, elas s√£o transferidas dos servidores da rede social da Calif√≥rnia para a m√°quina.\n<p>Isso ajuda muito para que o carregamento inicial do seu site seja mais r√°pido, j√° que s√≥ √© necess√°rio que seja baixado aquilo que √© vis√≠vel no in√≠cio. </p>\n<p>Existem duas boas formas de aplicar essa estrat√©gia, uma √© atrav√©s do atributo loading dispon√≠vel dede o ano passado para Chrome, Edge e Firefox: </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">loading</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://placekitten.com/400/400<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Outra abordagem √© a Intersection Observer API, que eat√° dispon√≠vel para tds navegadores e, no momento desse post, mais otimizada do que o atributo nativo. Em termos gerais, essa API dos navegadores possibilita que nossa Web App seja notificada quando um elemento em espec√≠fico adentrar a vis√£o da pessoa, sendo poss√≠vel assim tomar a√ß√µes como efetuar o carregamento da imagem. Para isso, basta fazer o seguinte: </p>\n<p>Trocamos o atributo src para data-src, evitando que a imagem seja baixada assim que o html √© renderizado pela p√°gina:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">data-src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span>https://placekitten.com/400/400<span class=\"token punctuation\">'</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> images <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">lazyLoad</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">target</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> io <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> src <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">;</span>\n        target<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  io<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nimages<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>lazyLoad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pronto! Assim, a imagem somente ser√° carregada quando entrar no viewport do dispositivo, tornando o carregamento da imagem mais inteligente.</p>\n<p>Mas tem um ponto com essa abordagem, ela aplica a mesma estrat√©gia pra todas imagens, e isso n√£o deveria ser feito. Existem imagens que voc√™ sabe que ser√£o vis√≠veis inicialmente, como o cabe√ßalho da p√°gina. Estas n√£o precisam ser carregadas com Lazy Loading. Tamb√©m se seu produto se preocupa com SEO, deve disponibilizar as imagens para os bots dos buscadores para que suas imagens sejam indexadas. Assim, podemos usar o poder do Angular pra nos ajudar com essas tarefas:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">[appLazyLoad]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span>https://placekitten.com/400/400<span class=\"token punctuation\">'</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Directive<span class=\"token punctuation\">,</span> ElementRef<span class=\"token punctuation\">,</span> Input<span class=\"token punctuation\">,</span> OnInit <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Directive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'[appLazyLoad]'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageLazyLoadingDirective</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OnInit</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">Input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> appLazyLoad<span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> nativeElement<span class=\"token operator\">:</span> HTMLImageElement<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\"><span class=\"token keyword\">private</span> elementRef<span class=\"token operator\">:</span> ElementRef<span class=\"token operator\">&lt;</span>HTMLImageElement<span class=\"token operator\">></span><span class=\"token punctuation\">,</span></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>nativeElement <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>elementRef<span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setIntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">setIntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> io <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>appLazyLoad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    io<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>nativeElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Com essa diretiva, √© poss√≠vel escolher quais imagens voc√™ quer aplicar Lazy Loading, e tamb√©m √© poss√≠vel desligar o lazy por alguma condi√ß√£o da necessidade do seu produto.</p>\n<p>Vejam um exemplo funcionando no <a href=\"https://stackblitz.com/edit/image-lazy-load?file=src/app/app.component.ts\">Stackblitz</a>!</p>\n<p>√â legal ver a web cada vez mais moderna e eficiente. üòÄ</p>\n<p>Por hoje era isso, valeu!</p>","frontmatter":{"title":"Lazy Loading de Imagens com Angular","date":"September 16, 2020","description":"Lazy Loading de Imagens com Angular"}},"previous":null,"next":null},"pageContext":{"id":"cc85ac43-7658-5d0c-bed3-94287bf1e1b7","previousPostId":null,"nextPostId":null}},"staticQueryHashes":["2841359383","916993862"]}